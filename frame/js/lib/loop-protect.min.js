/**
 * Copyright (c) 2008-2012 Remy Sharp, http://jsbin.com
 * https://github.com/jsbin/jsbin/blob/master/MIT-LICENSE.TXT
 */

/**
 * Protect against infinite loops.
 * Look for for, while and do loops, and insert a check function at the start of
 * the loop. If the check function is called many many times then it returns
 * true, preventing the loop from running again.
 */
window.loopProtect=window.loopProtect||function(){var l={counters:{},rewriteLoops:function(e,g){var f=[],h=e.split("\n"),l=/\b(for|while|do)\b/g;g||(g=0);var s=!1,t={},u={},v=function(a,c,b){return c.slice(0,b)+";window.loopProtect.protect({ line: "+a+", reset: true }); "+c.slice(b)};h.forEach(function(a,c){l.lastIndex=0;if(!s){-1!==a.toLowerCase().indexOf("noprotect")&&(s=!0);var b=-1,e=-1,m=c,n=c-g+1,d="",w=!1,k=e=!1,e=a.match(l)||[],p=e.length?e[0]:"",r=0,q=0;if(!t[c])if(u[c])f.push(a);else if(p&&
1===e.length){w="do"===p;for(e=b=a.indexOf(p);-1<--b;){d=a.substr(b,1);if('"'===d||"'"===d||"."===d){f.push(a);return}if("/"===d||"*"===d)if(--b,"/"===d){f.push(a);return}}if(0<c){var b=c,d=1,x=-1,y=-1;do if(b-=1,x=h[b].indexOf("*/"),y=h[b].indexOf("/*"),-1!==x&&d++,-1!==y&&(d--,0===d)){f.push(a);return}while(0!==b)}b=a.indexOf(p)+p.length;b===a.length&&b===a.length&&c<h.length-1&&(f.push(a),c++,a=h[c],t[c]=!0,b=0);for(;b<a.length;){d=a.substr(b,1);"("===d&&r++;")"===d&&(r--,0===r&&!1===k&&(k=b));
"{"===d&&q++;"}"===d&&q--;if(0===r&&(";"===d||"{"===d)){";"===d?c!==m?(f[m]=f[m].substring(0,k+1)+"{\nif (window.loopProtect.protect({ line: "+n+" })) break;\n",a+="\n}\n"):a=a.substring(0,k+1)+"{\nif (window.loopProtect.protect({ line: "+n+" })) break;\n"+a.substring(k+1)+"\n}\n":"{"===d&&(k=";\nif (window.loopProtect.protect({ line: "+n+" })) break;\n",a=a.substring(0,b+1)+k+a.substring(b+1),b+=k.length);c===m?(a=v(n,a,e),b+=(";window.loopProtect.protect({ line: "+c+", reset: true }); ").length):
f[m]=v(n,f[m],e);f.push(a);if(w)for(;b<a.length;){d=a.substr(b,1);"{"===d&&q++;"}"===d&&q--;if((e=0===q?!0:!1)&&-1!==a.indexOf("while")){u[c]=!0;break}b++;b===a.length&&c<h.length-1&&(c++,a=h[c],b=0)}break}b++;b===a.length&&c<h.length-1&&(f.push(a),c++,a=h[c],t[c]=!0,b=0)}}else f.push(a)}});return s?e:f.join("\n")},protect:function(e){l.counters[e.line]=l.counters[e.line]||{};var g=l.counters[e.line];e.reset&&(g.time=+new Date,g.hit=0,g.last=0);g.hit++;if(100<+new Date-g.time)return e="Exiting potential infinite loop at line "+
e.line+'. To disable loop protection: add "// noprotect" to your code',window.proxyConsole?window.proxyConsole.error(e):console.error(e),!0;g.last++;return!1},reset:function(){l.counters={}}};return l}();
